version: '3.8'
services:
  agent:
    container_name: agent
    image: timberio/vector:nightly-alpine
    volumes:
      - ./vector/agent:/etc/vector:ro
      - /var/run/docker.sock:/var/run/docker.sock
    depends_on:
      - aggregator
  aggregator:
    container_name: aggregator
    image: timberio/vector:nightly-alpine
    ports:
      - 8686:8686
    environment:
      - LOG=debug
    volumes:
      - ./vector/aggregator:/etc/vector:ro
      - /var/run/docker.sock:/var/run/docker.sock
  tap:
    container_name: tap
    image: timberio/vector:nightly-alpine
    command: ["tap", "--url", "http://aggregator:8686/graphql"]
    depends_on:
      - agent